extends ./layout
block content
  div(ng-controller="main")
    .ui.segment.graph( style='height: 100%; position: absolute;width: 100%;')
      #mygraph
      .ui.left.internal.attached.rail.graph
        // elejir archivo
        .ui.segment.mini.center.aligned
          .ui.one.column.grid
            .column
              .ui.two.column.grid
                .column
                  .ui.icon.buttons.mini
                    button.ui.button(ng-disabled=" !cnc.arduino || cnc.working || cnc.file.line.total == 0 && !cnc.pause.status" ng-click='start()')
                      i.play.icon.green
                    button.ui.button(ng-disabled="!cnc.working"  ng-click='pausa()')
                      i.pause.icon.blue
                    button.ui.button(ng-disabled="!cnc.working && !cnc.pause.status" ng-click='parar()')
                      i.stop.icon.red
                    button.ui.button(ng-disabled="cnc.working" ng-click="setFile()"  ) Archivo
                .column
                  label.ui.label(popup-element data-title='Hora estimadas' data-content="Inicio: {{cnc.time.start | date:'HH:mm'}} Fin: {{cnc.time.end | date:'HH:mm'}}"  data-position="right center" data-variation="large") Fin:
                    .detail {{cnc.time.end | date:'HH:mm'}}
            .column(style="padding:0;") 
              .ui.labeled.input.mini.action( popup-element data-content="Posición inicial de la herramienta. {{initialLine}}")
                .ui.label  Posición de la herramienta:
                input( style='width:4rem;' ng-model='initialLine' type='text' )
                button.ui.icon.button(ng-click="")
                  i.repeat.icon.green
            .column
              .ui.progress.indicating.small( ng-class='progressBar' data-percent='{{cnc.file.line.progress}}' style="margin: 0em 0em;")
                .bar(popup-element data-content="{{cnc.file.line.run}} de {{cnc.file.line.total}}" style='transition-duration: 300ms; width: {{cnc.file.line.progress}}%;')  
                  .progress(style="color: rgba(255, 255, 255, 1);") {{cnc.file.line.progress}}%
        // tabla
        .ui.segment.mini.center.aligned(ng-show="lineTable.show")
            //.ui.one.column.grid
            table.ui.table.very.basic.compact.small
              thead
                tr
                  th linea
                  th X
                  th Y
                  th Z
              tbody
                tr(popup-element data-title="{{line.code}}" ng-repeat="line in lineTable" ng-class="line.type" )
                  td {{line.nro}}
                  td(popup-element data-title="Pasos: {{line.steps[0]}}") {{ line.ejes[0] | number : 2}}
                  td(popup-element data-title="Pasos: {{line.steps[1]}}") {{ line.ejes[1] | number : 2}}
                  td(popup-element data-title="Pasos: {{line.steps[2]}}") {{ line.ejes[2] | number : 2}}
      .ui.right.internal.attached.rail.graph
        // comando manuales
        .ui.segment.center.aligned
          .ui.one.column.grid
            .column(style=" padding: 6px 6px !important; margin: 0 !important; ")
              .ui.action.input.mini.fluid
                input(placeholder='Enviar comando.' type='text' ng-model='comando' ng-value='' ng-disabled="!cnc.arduino || cnc.working ")
                button.ui.button(ng-disabled="!cnc.arduino || cnc.working || comando.length==0" type="submit",ng-click='enviarDatos(comando)') Enviar
            
            .column(style=" padding: 6px 6px !important; margin: 0 !important; ")
              .ui.right.labeled.input.mini.fluid
                input( ng-model='inputStepsmm' type='text' )
                //button.ui.primary.right.labeled.button(ng-class='btnStepsmmClass' ng-click='setStepsmm()' ) {{btnStepsmm}}
                .ui.dropdown.label
                  .text pasos
                  i.dropdown.icon
                  .menu
                    .item(style="padding: 0.71428571rem 0.74rem !important;") pasos
                    .item(style="padding: 0.71428571rem 0.7rem !important;") mm
            
            .ui.three.column.grid.center.aligned(style=" padding: 6px 6px !important; margin: 0 !important; ")
              .column.fluid(style="padding: 6px 6px;")
                .two.ui.buttons.mini
                  button.ui.button.red(popup-element data-title="A" ng-disabled=" !cnc.arduino || cnc.working " ng-click='moverManual(inputStepsmm,"X","")' ) X+
                  button.ui.button(popup-element data-title="D" ng-disabled=" !cnc.arduino || cnc.working " ng-click='moverManual(inputStepsmm,"X","-")' ) X-
              .column.fluid(style="padding: 6px 6px;")
                .two.ui.buttons.mini
                  button.ui.button.blue(popup-element data-title="W" ng-disabled=" !cnc.arduino || cnc.working " ng-click='moverManual(inputStepsmm,"Y","")' ) Y+
                  button.ui.button(popup-element data-title="S" ng-disabled=" !cnc.arduino || cnc.working " ng-click='moverManual(inputStepsmm,"Y","-")' ) Y-
              .column.fluid(style="padding: 6px 6px;")
                .two.ui.buttons.mini
                  button.ui.button.green(popup-element data-title="Q" ng-disabled=" !cnc.arduino || cnc.working " ng-click='moverManual(inputStepsmm,"Z","")' ) Z+
                  button.ui.button(popup-element data-title="E" ng-disabled=" !cnc.arduino || cnc.working " ng-click='moverManual(inputStepsmm,"Z","-")' ) Z-
    
    #statusbar.statusbar(ng-class="statusBar.type" style="top:578px"  role='contentinfo')
      .statusbar-item.left(ng-show="statusBar.message || lineTable.line.length <= 0" popup-element data-title="{{statusBar.message}}") {{statusBar.message}}
      
      .statusbar-item.left(ng-show="lineTable.line.length > 0" popup-element data-title="Linea: {{lineTable.line[lineTable.line.length-1].nro}}") Nro: {{lineTable.line[lineTable.line.length-1].nro}}
      .statusbar-item.left(ng-show="lineTable.line.length > 0" popup-element data-title="Code en linea: {{lineTable.line[lineTable.line.length-1].code}}") Code: {{lineTable.line[lineTable.line.length-1].code}}
      .statusbar-item.left(ng-show="lineTable.line.length > 0" popup-element data-title="X: {{ lineTable.line[lineTable.line.length-1].ejes[0] | number : 2}}" data-content="Pasos: {{lineTable.line[lineTable.line.length-1].steps[0]}}") X: {{ lineTable.line[lineTable.line.length-1].ejes[0] | number : 2}}
      .statusbar-item.left(ng-show="lineTable.line.length > 0" popup-element data-title="Y: {{ lineTable.line[lineTable.line.length-1].ejes[1] | number : 2}}" data-content="Pasos: {{lineTable.line[lineTable.line.length-1].steps[1]}}") Y: {{ lineTable.line[lineTable.line.length-1].ejes[1] | number : 2}}
      .statusbar-item.left(ng-show="lineTable.line.length > 0" popup-element data-title="Z: {{ lineTable.line[lineTable.line.length-1].ejes[2] | number : 2}}" data-content="Pasos: {{lineTable.line[lineTable.line.length-1].steps[2]}}") Z: {{ lineTable.line[lineTable.line.length-1].ejes[2] | number : 2}}
      
      .statusbar-item.right Lineas interpetadas: {{cnc.file.line.run}} de {{cnc.file.line.total}} - {{cnc.file.line.progress}}%

    .modal.uk-modal(ng-controller="prefs")
      .uk-modal-dialog
        button.uk-modal-close.uk-close(type='button')
        .ui.pointing.secondary.menu
          a.item.active(data-tab='motorx') Motor X
          a.item(data-tab='motory') Motor Y
          a.item(data-tab='motorz') Motor Z
          a.item(data-tab='generales') Generales
        .ui.tab.segment.active(data-tab='motorx')
          form.uk-form.uk-grid
            .uk-form-row
              .ui.checkbox
                input(checkbox type="checkbox" ng-model="configModal.motor.x.sense")
                label Sentido Invertido.
            .uk-form-row
              p Milimetros por pasos.
                .uk-form-controls
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.x.advance" type="number")
                  label mm. 
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.x.steps" type="number")
                  label pasos. 
              p Velocidad mm/min.
                .uk-form-controls(disabled)
                    input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.x.speed.working" type="number")
                    label de Trabajo.
                    input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.x.speed.idle" type="number")
                    label en Vasio.
            .uk-form-row
              p Sacar de mm/min y el avance {{configModal.motor.x.time}}
        .ui.tab.segment(data-tab='motory')
          form.uk-form
            .uk-form-row.uk-grid
              .uk-width-1-2
                .ui.checkbox
                  input( checkbox ng-disabled="iqualx" type="checkbox"  ng-model="configModal.motor.y.sense")
                  label Sentido Invertido.
              .uk-width-1-2
                .ui.checkbox
                  input(checkbox type="checkbox" ng-model="iqualx" ng-click="iqualX()")
                  label Igual que Motor X.
            .uk-form-row
              p Milimetros por pasos.
                .uk-form-controls
                  input.uk-form-width-small.uk-form-small(ng-disabled="iqualx" type="number"  ng-model="configModal.motor.y.advance")
                  label mm. 
                  input.uk-form-width-small.uk-form-small(ng-disabled="iqualx" type="number"  ng-model="configModal.motor.y.steps")
                  label pasos. 
              p Velocidad mm/min.
                .uk-form-controls(disabled)
                    input.uk-form-width-small.uk-form-small(ng-disabled="iqualx" type="number"  ng-model="configModal.motor.y.speed.working")
                    label de Trabajo. 
                    input.uk-form-width-small.uk-form-small(ng-disabled="iqualx" type="number" ng-model="configModal.motor.y.speed.idle")
                    label en Vasio. 
            .uk-form-row
              p Sacar de mm/min y el avance {{configModal.motor.y.time}}
        .ui.tab.segment(data-tab='motorz')
          form.uk-form.uk-grid
            .uk-form-row
              .ui.checkbox
                input(checkbox type="checkbox" ng-model="configModal.motor.z.sense")
                label Sentido Invertido.
            .uk-form-row
              p Milimetros por pasos.
                .uk-form-controls
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.z.advance" type="number")
                  label mm. 
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.z.steps" type="number")
                  label pasos. 
              p Velocidad mm/min.
                .uk-form-controls(disabled)
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.z.speed.working" type="number")
                  label de Trabajo. 
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.motor.z.speed.idle" type="number")
                  label en Vasio. 
        .ui.tab.segment(data-tab='generales')
          form.uk-form.uk-grid
            span.uk-form-label Medidas de la piesa a trabar.
            .uk-form-controls.uk-form-controls-text
              .uk-form-controls-condensed
                label para X 
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.workpiece.x" type="number")
                  | mm.
              .uk-form-controls-condensed
                label para Y 
                  input.uk-form-width-small.uk-form-small( ng-model="configModal.workpiece.y" type="number")
                  | mm.
              p.uk-form-controls-condensed
                label Escala: 
                  input.uk-form-width-small.uk-form-small(type='number' ng-model="configModal.scale" )
        .uk-modal-footer.uk-text-right
          button.uk-button( ng-click='cancel()' ) Cancelar
          button.uk-button.uk-button-primary( ng-click='save()' ) Guardar

block script
  script(type="text/javascript").
    var angular = angular.module('app',[]);
  script(src="./../js/angular.js" type="text/javascript")
  script(src="./../js/controller/ng-main.js" type="text/javascript")
  script(src="./../js/controller/ng-prefs.js" type="text/javascript")
  script(src="./../js/factory/ipc.js" type="text/javascript")
  script(src="./../js/factory/line.js" type="text/javascript")
  script(src="./../js/factory/notify.js" type="text/javascript")